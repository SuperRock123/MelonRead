"use strict";(self["webpackChunkmelonread_vue_test2"]=self["webpackChunkmelonread_vue_test2"]||[]).push([[446],{7446:function(t,e,a){a.r(e),a.d(e,{default:function(){return G}});var i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"passage_display_vue"}},[e("van-nav-bar",{attrs:{title:"文章浏览","left-text":"返回","left-arrow":""},on:{"click-left":function(e){return t.$router.go(-1)}}}),e("ArticlePage",{staticClass:"animate__animated animate__fadeInDown",attrs:{article:t.article}}),e("div",{staticClass:"like"},[e("van-button",{ref:"like-btn",staticClass:"animate__animated animate__lightSpeedInRight",attrs:{icon:"star-o",type:"default",color:"#ffaaa5"},on:{click:t.onClickLike}},[t._v(t._s(t.like.likes)+"赞 ")]),e("userImg",{attrs:{user:t.user,enableLink:!0}})],1),e("div",{staticClass:"share"},[e("van-cell",{attrs:{title:"分享给朋友"},on:{click:function(e){t.showShare=!0}}}),e("van-share-sheet",{attrs:{title:"立即分享给好友",options:t.options},model:{value:t.showShare,callback:function(e){t.showShare=e},expression:"showShare"}})],1),e("commentInput",{staticClass:"animate__animated animate__flipInY",attrs:{modelValue:t.commentContent},on:{submit:t.handleCommentSubmit}}),t._l(t.comments,(function(a){return e("commentCard",{key:a.commentId,attrs:{comment:a,"enable-link":!0,"enable-delete":t.enableDelete},on:{clickDelete:t.onDeleteComment}})}))],2)},s=[],n=a(4754),r=a(2549),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-page"},[e("div",{staticClass:"article-header"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),e("div",{staticClass:"article-meta"},[t.article.author?e("span",{staticClass:"article-author"},[t._v(t._s(t.article.author))]):t._e(),e("span",{staticClass:"article-date"},[t._v(t._s(t.formatDate(t.article.createdAt)))])])]),e("div",{staticClass:"article-content"},[e("p",[t._v(t._s(t.article.content))])]),e("div",{staticClass:"article-footer"},[e("span",{staticClass:"article-views"},[t._v("浏览: "+t._s(t.article.views)+"次")])])])},c=[],o={name:"ArticlePage",props:{article:{type:Object,required:!0}},methods:{formatDate(t){const e=new Date(t);return e.toLocaleDateString()}}},u=o,m=a(1656),d=(0,m.A)(u,l,c,!1,null,"5b164b45",null),h=d.exports,k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-profile"},[e("div",{staticClass:"avatar-wrapper animate__animated animate__zoomIn"},[e("img",{staticClass:"avatar",attrs:{src:t.user.avatar,alt:"User Avatar"},on:{click:t.onClickUserAvatar}})]),e("div",{staticClass:"username"},[e("span",[t._v("作者:"+t._s(t.user.username))])])])},p=[],v=(a(4114),{name:"UserProfile",props:{user:{type:Object,required:!0},enableLink:{type:Boolean,required:!1,default:!1}},methods:{onClickUserAvatar(){!1!==this.enableLink&&this.$router.push(`/userProfile?userId=${this.user.userId}`)}}}),C=v,_=(0,m.A)(C,k,p,!1,null,"01366600",null),f=_.exports,I=a(8073);function b(t,e){return I.A.post("article-like/like",{userId:t,articleId:e})}function w(t,e){return I.A.post("/article-like/has-liked",{userId:t,articleId:e})}function g(t){return I.A.get("article-like/unlike",{params:{likeId:t}})}function A(t){return I.A.get("article-like/like-count",{params:{articleId:t}})}var y=a(571);function D(t){return I.A.get(`/comment/article/${t}`)}function L(t,e,a){return I.A.post("/comment/post",{articleId:t,userId:e,content:a})}function q(t){return I.A.get(`/comment/delete/${t}`)}var U=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-card"},[e("div",{staticClass:"user-info",on:{click:t.onClickUserInfo}},[e("img",{staticClass:"user-avatar",attrs:{src:t.comment.userAvatar,alt:"User Avatar"},on:{click:t.handleAvatarClick}}),e("span",{staticClass:"username"},[t._v(t._s(t.comment.username))])]),e("div",{staticClass:"comment-content"},[e("p",{staticClass:"content"},[t._v(t._s(t.comment.content))]),e("span",{staticClass:"timestamp"},[t._v(t._s(t.formatDate(t.comment.createdAt)))]),t.enableDelete?e("span",{staticClass:"timestamp delete-btn",on:{click:t.onClickDelete}},[t._v("删除")]):t._e()])])},$=[],S={name:"CommentCard",props:{comment:{type:Object,required:!0},enableLink:{type:Boolean,required:!1,default:!1},enableDelete:{type:Boolean,required:!1,default:!1}},methods:{handleAvatarClick(){this.$emit("avatar-click",this.comment.userId)},formatDate(t){const e={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Date(t).toLocaleDateString(void 0,e)},onClickUserInfo(){!1!==this.enableLink&&this.$router.push(`/userProfile?userId=${this.comment.userId}`)},onClickDelete(){this.$emit("clickDelete",this.comment.commentId)}}},x=S,F=(0,m.A)(x,U,$,!1,null,"16b050c8",null),P=F.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-input"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.currentContent,expression:"currentContent"}],staticClass:"textarea",class:{focused:t.isFocused},attrs:{placeholder:"写下你的评论..."},domProps:{value:t.currentContent},on:{focus:t.handleFocus,blur:t.handleBlur,input:function(e){e.target.composing||(t.currentContent=e.target.value)}}}),e("button",{staticClass:"submit-btn",attrs:{disabled:!t.currentContent.trim()},on:{click:t.submitComment}},[t._v(" 发布评论 ")])])},V=[],j={name:"CommentInput",props:{modelValue:{type:String,required:!0}},data(){return{isFocused:!1,currentContent:this.modelValue}},watch:{modelValue(t){this.currentContent=t},currentContent(t){this.$emit("update:modelValue",t)}},methods:{handleFocus(){this.isFocused=!0},handleBlur(){this.isFocused=!1},submitComment(){this.currentContent.trim()&&(this.$emit("submit",this.currentContent.trim()),this.currentContent="")}}},O=j,z=(0,m.A)(O,B,V,!1,null,"0e16b03b",null),Q=z.exports,E=a(316),N={name:"passage_display_vue",components:{ArticlePage:h,userImg:f,commentCard:P,commentInput:Q},mounted(){},async created(){const t=await(0,n.zE)(this.$route.query.id);this.article=t.data;const{data:e}=await(0,r.kl)(this.article.authorId);console.log(e),this.user=e,await this.onLike();const a=await D(this.article.articleId);this.comments=a.data,(0,y.F6)()===this.article.authorId&&(this.enableDelete=!0)},data:()=>({like:{hasLiked:!1,likes:0,likeId:0},localUserId:(0,y.F6)(),article:{},user:{},showShare:!1,likeCount:0,comments:[],commentContent:"",enableDelete:!1,options:[[{name:"微信",icon:"wechat"},{name:"朋友圈",icon:"wechat-moments"},{name:"微博",icon:"weibo"},{name:"QQ",icon:"qq"}],[{name:"复制链接",icon:"link"},{name:"分享海报",icon:"poster"},{name:"二维码",icon:"qrcode"},{name:"小程序码",icon:"weapp-qrcode"}]]}),methods:{async onClickLike(){if(""===(0,y.F6)())return void(0,E.A)({type:"warning",message:"请先登录"});const t=await w(this.localUserId,this.article.articleId);this.like.likeId=t.data,0===t.data?this.like.hasLiked=!1:this.like.hasLiked=!0,this.like.likeId=t.data,!0===this.like.hasLiked?await g(this.like.likeId):await b(this.localUserId,this.article.articleId);const{data:e}=await A(this.article.articleId);this.like.likes=e},async onLike(){const t=await w(this.localUserId,this.article.articleId);this.like.likeId=t.data,0===t.data?this.like.hasLiked=!1:this.like.hasLiked=!0;const{data:e}=await A(this.article.articleId);this.like.likes=e},async handleCommentSubmit(t){if(""===(0,y.F6)())return void(0,E.A)({type:"warning",message:"请先登录"});const e=await L(this.article.articleId,this.localUserId,t);this.comments=e.data},async onDeleteComment(t){const e=await q(t);if(200!==e.code)(0,E.A)({type:"danger",message:"删除失败"});else{(0,E.A)({type:"success",message:"删除评论"});const t=await D(this.article.articleId);this.comments=t.data}}},watch:{}},R=N,Y=(0,m.A)(R,i,s,!1,null,"2710b146",null),G=Y.exports}}]);
//# sourceMappingURL=446.3d02dbd9.js.map